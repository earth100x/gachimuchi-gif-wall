# Story 1.2: Tenor API Integration

## Status

Draft

## Story

**As a** developer,
**I want** to integrate with the Tenor API to fetch "gachimuchi" GIFs,
**so that** I can display real GIF data in the application.

## Acceptance Criteria

1. Tenor API client function created with proper error handling
2. API call to fetch "gachimuchi" GIFs with limit=8 parameter
3. TypeScript interfaces defined for API response
4. Error handling for API failures and rate limits
5. Loading states implemented for API calls
6. API integration tested with mock data

## Tasks / Subtasks

- [ ] Task 1: Create TypeScript interfaces for Tenor API (AC: 3)

  - [ ] Create `src/types/tenor.ts` with TenorResponse interface
  - [ ] Create `src/types/gif.ts` with GIF interface
  - [ ] Export types from `src/types/index.ts`
  - [ ] Add unit tests for type definitions

- [ ] Task 2: Implement Tenor API service (AC: 1, 2)

  - [ ] Create `src/services/tenorAPI.ts` with TenorAPIClient class
  - [ ] Implement searchGifs method with query and limit parameters
  - [ ] Add proper error handling for API failures
  - [ ] Add rate limiting handling with exponential backoff
  - [ ] Export service from `src/services/index.ts`

- [ ] Task 3: Create custom hook for API integration (AC: 4, 5)

  - [ ] Create `src/hooks/useTenorAPI.ts` custom hook
  - [ ] Implement loading state management
  - [ ] Implement error state management
  - [ ] Add searchGifs function with proper state updates
  - [ ] Export hook from `src/hooks/index.ts`

- [ ] Task 4: Add environment configuration (AC: 1)

  - [ ] Update `.env.example` with TENOR_API_KEY variable
  - [ ] Add environment variable validation
  - [ ] Document API key setup in README

- [ ] Task 5: Implement error handling utilities (AC: 4)

  - [ ] Create `src/utils/errorHandler.ts` with error handling functions
  - [ ] Add user-friendly error message mapping
  - [ ] Add retry logic for transient failures
  - [ ] Export utilities from `src/utils/index.ts`

- [ ] Task 6: Add comprehensive testing (AC: 6)
  - [ ] Create unit tests for `src/services/tenorAPI.test.ts`
  - [ ] Create unit tests for `src/hooks/useTenorAPI.test.ts`
  - [ ] Create unit tests for `src/utils/errorHandler.test.ts`
  - [ ] Add mock data for testing in `src/__mocks__/tenorAPI.ts`
  - [ ] Test error scenarios and loading states

## Dev Notes

### Previous Story Insights

From Story 1.1 completion:

- Next.js 15.5.4 with TypeScript 5.9.2 successfully configured
- Tailwind CSS 4.0 with dark theme styling implemented
- Project structure with organized directories created
- ESLint and Prettier configuration working properly
- All builds pass successfully with no errors

### Data Models

**GIF Interface** [Source: architecture/data-models.md#gif]:

```typescript
interface GIF {
  id: string;
  title: string;
  url: string;
  preview: string;
  dimensions: {
    width: number;
    height: number;
  };
  created: string;
}
```

**TenorResponse Interface** [Source: architecture/data-models.md#tenor-api-response]:

```typescript
interface TenorResponse {
  results: GIF[];
  next?: string;
  error?: string;
}
```

### API Specifications

**Tenor API Integration** [Source: architecture/external-apis.md#tenor-api]:

- Base URL: https://g.tenor.com/v1
- Authentication: API key in query parameters
- Rate Limits: 1000 requests per day (free tier)
- Endpoint: GET /search for "gachimuchi" GIFs
- CORS enabled for browser requests
- Pagination support with next token

**API Client Pattern** [Source: architecture/frontend-architecture.md#api-client-setup]:

```typescript
class TenorAPIClient {
  private baseURL = "https://g.tenor.com/v1";
  private apiKey: string;

  async searchGifs(
    query: string,
    limit: number = 8,
    pos?: string
  ): Promise<TenorResponse>;
}
```

### Component Specifications

**Custom Hook Pattern** [Source: architecture/frontend-architecture.md#service-example]:

```typescript
export const useTenorAPI = () => {
  const [gifs, setGifs] = useState<GIF[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const searchGifs = useCallback(async (query: string) => {
    // Implementation with proper state management
  }, []);

  return { gifs, loading, error, searchGifs };
};
```

### File Locations

Based on unified project structure [Source: architecture/unified-project-structure.md]:

- `src/types/tenor.ts` - Tenor API response types
- `src/types/gif.ts` - GIF data model types
- `src/types/index.ts` - Type exports
- `src/services/tenorAPI.ts` - Tenor API client service
- `src/services/index.ts` - Service exports
- `src/hooks/useTenorAPI.ts` - Custom hook for API integration
- `src/hooks/index.ts` - Hook exports
- `src/utils/errorHandler.ts` - Error handling utilities
- `src/utils/index.ts` - Utility exports
- `src/__mocks__/tenorAPI.ts` - Mock data for testing
- `.env.example` - Environment variables template

### Testing Requirements

**Test Organization** [Source: architecture/testing-strategy.md#test-organization]:

- Test files in `src/__tests__/` directory
- Unit tests for services, hooks, and utilities
- Mock data in `src/__mocks__/` directory
- Use Jest + React Testing Library for testing

**Testing Framework** [Source: architecture/tech-stack.md#frontend-testing]:

- Jest + React Testing Library for component and hook testing
- Test naming convention: `ComponentName.test.tsx`

**Specific Testing Requirements** [Source: architecture/testing-strategy.md#test-examples]:

- Test API client with mock responses
- Test custom hook state management
- Test error handling scenarios
- Test loading states
- Test rate limiting behavior

### Technical Constraints

**Technology Stack** [Source: architecture/tech-stack.md]:

- TypeScript 5.9.2 for type safety
- Next.js 15.1.8 for framework
- React Hooks 19.1.1 for state management
- REST API style for Tenor integration
- Browser Cache for HTTP caching

**Coding Standards** [Source: architecture/coding-standards.md]:

- Type Safety: Always use TypeScript interfaces for API responses
- API Calls: Never make direct fetch calls - use the tenorAPI service
- Environment Variables: Access only through process.env with NEXT*PUBLIC* prefix
- Error Handling: All API calls must use try-catch with user-friendly error messages
- Performance: Implement proper loading states and error boundaries

### Testing

**Test File Location**: `src/__tests__/` directory [Source: architecture/testing-strategy.md#test-organization]

**Testing Framework**: Jest + React Testing Library [Source: architecture/tech-stack.md#frontend-testing]

**Test Standards**:

- Unit tests for API service functions
- Unit tests for custom hooks
- Unit tests for error handling utilities
- Test naming convention: `ComponentName.test.tsx` [Source: architecture/testing-strategy.md#test-examples]

**Specific Testing Requirements**:

- Test TenorAPIClient.searchGifs method with various parameters
- Test useTenorAPI hook state management (loading, error, data)
- Test error handling for network failures and API errors
- Test rate limiting and retry logic
- Test environment variable validation
- Mock Tenor API responses for consistent testing

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-01-12 | 1.0     | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

_To be populated by Dev Agent_

## QA Results

_To be populated by QA Agent_
